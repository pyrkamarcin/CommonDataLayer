<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0000C - Alternative communication method - The Common Data Layer</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Common Data Layer</a></li><li class="chapter-item expanded "><a href="../how_it_works.html"><strong aria-hidden="true">2.</strong> How does it work</a></li><li class="chapter-item expanded "><a href="../getting_started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../deployment/index.html"><strong aria-hidden="true">4.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/local/index.html"><strong aria-hidden="true">4.1.</strong> Local deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../deployment/local/docker-compose.html"><strong aria-hidden="true">4.1.1.</strong> docker-compose</a></li><li class="chapter-item expanded "><a href="../deployment/local/helm.html"><strong aria-hidden="true">4.1.2.</strong> Helm</a></li></ol></li><li class="chapter-item expanded "><a href="../deployment/production/index.html"><strong aria-hidden="true">4.2.</strong> Production-grade deployment</a></li></ol></li><li class="chapter-item expanded "><a href="../schemas_and_views.html"><strong aria-hidden="true">5.</strong> Schemas and Views</a></li><li class="chapter-item expanded "><a href="../examples/index.html"><strong aria-hidden="true">6.</strong> Examples</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> TODO</div></li></ol></li><li class="chapter-item expanded "><a href="../features/index.html"><strong aria-hidden="true">7.</strong> Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../features/ordering.html"><strong aria-hidden="true">7.1.</strong> Message ordering</a></li><li class="chapter-item expanded "><a href="../features/materialization.html"><strong aria-hidden="true">7.2.</strong> Materialization</a></li><li class="chapter-item expanded "><a href="../features/client_routing.html"><strong aria-hidden="true">7.3.</strong> Client routing</a></li></ol></li><li class="chapter-item expanded "><a href="../versioning.html"><strong aria-hidden="true">8.</strong> Versioning</a></li><li class="chapter-item expanded "><a href="../protocol.html"><strong aria-hidden="true">9.</strong> Protocol schema</a></li><li class="chapter-item expanded "><a href="../benchmarks.html"><strong aria-hidden="true">10.</strong> Benchmarks</a></li><li class="chapter-item expanded "><a href="../architecture/index.html"><strong aria-hidden="true">11.</strong> Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/management.html"><strong aria-hidden="true">11.1.</strong> Management Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/cli.html"><strong aria-hidden="true">11.1.1.</strong> CLI</a></li><li class="chapter-item expanded "><a href="../architecture/web_admin.html"><strong aria-hidden="true">11.1.2.</strong> Admin Web Panel</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture/api.html"><strong aria-hidden="true">11.2.</strong> GraphQL API</a></li><li class="chapter-item expanded "><a href="../architecture/configuration.html"><strong aria-hidden="true">11.3.</strong> Configuration Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/schema_registry.html"><strong aria-hidden="true">11.3.1.</strong> Schema Registry</a></li><li class="chapter-item expanded "><a href="../architecture/leader_elector.html"><strong aria-hidden="true">11.3.2.</strong> Leader Elector</a></li><li class="chapter-item expanded "><a href="../architecture/edge_registry.html"><strong aria-hidden="true">11.3.3.</strong> Edge Registry</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture/ingestion.html"><strong aria-hidden="true">11.4.</strong> Ingestion Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/data_router.html"><strong aria-hidden="true">11.4.1.</strong> Data Router</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture/storage.html"><strong aria-hidden="true">11.5.</strong> Storage Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/command_service.html"><strong aria-hidden="true">11.5.1.</strong> Command Service</a></li><li class="chapter-item expanded "><a href="../architecture/db_shrinker_storage.html"><strong aria-hidden="true">11.5.2.</strong> Db Shrinker Storage</a></li><li class="chapter-item expanded "><a href="../architecture/query_service.html"><strong aria-hidden="true">11.5.3.</strong> Query Service</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.6.</strong> Materialization Layer</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/object_builder.html"><strong aria-hidden="true">11.6.1.</strong> Object Builder</a></li><li class="chapter-item expanded "><a href="../architecture/partial_update_engine.html"><strong aria-hidden="true">11.6.2.</strong> Partial Update Engine</a></li><li class="chapter-item expanded "><a href="../architecture/materializer_general.html"><strong aria-hidden="true">11.6.3.</strong> General Materializer</a></li><li class="chapter-item expanded "><a href="../architecture/materializer_ondemand.html"><strong aria-hidden="true">11.6.4.</strong> On Demand Materializer</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture/retrieval.html"><strong aria-hidden="true">11.7.</strong> Retrieval Layer</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../architecture/query_router.html"><strong aria-hidden="true">11.7.1.</strong> Query Router</a></li></ol></li><li class="chapter-item expanded "><a href="../architecture/utils.html"><strong aria-hidden="true">11.8.</strong> Utils</a></li></ol></li><li class="chapter-item expanded "><a href="../configuration/index.html"><strong aria-hidden="true">12.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../configuration/api.html"><strong aria-hidden="true">12.1.</strong> api</a></li><li class="chapter-item expanded "><a href="../configuration/command-service.html"><strong aria-hidden="true">12.2.</strong> command-service</a></li><li class="chapter-item expanded "><a href="../configuration/data-router.html"><strong aria-hidden="true">12.3.</strong> data-router</a></li><li class="chapter-item expanded "><a href="../configuration/edge-registry.html"><strong aria-hidden="true">12.4.</strong> edge-registry</a></li><li class="chapter-item expanded "><a href="../configuration/materializer-general.html"><strong aria-hidden="true">12.5.</strong> materializer-general</a></li><li class="chapter-item expanded "><a href="../configuration/materializer-ondemand.html"><strong aria-hidden="true">12.6.</strong> materializer-ondemand</a></li><li class="chapter-item expanded "><a href="../configuration/object-builder.html"><strong aria-hidden="true">12.7.</strong> object-builder</a></li><li class="chapter-item expanded "><a href="../configuration/partial-update-engine.html"><strong aria-hidden="true">12.8.</strong> partial-update-engine</a></li><li class="chapter-item expanded "><a href="../configuration/query-router.html"><strong aria-hidden="true">12.9.</strong> query-router</a></li><li class="chapter-item expanded "><a href="../configuration/query-service.html"><strong aria-hidden="true">12.10.</strong> query-service</a></li><li class="chapter-item expanded "><a href="../configuration/query-service-ts.html"><strong aria-hidden="true">12.11.</strong> query-service-ts</a></li><li class="chapter-item expanded "><a href="../configuration/schema-registry.html"><strong aria-hidden="true">12.12.</strong> schema-registry</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> RFCs</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rfc/CDLF-0000C-00-rfc-01.html" class="active"><strong aria-hidden="true">13.1.</strong> 0000C - Alternative communication method</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-0000E-00-rfc-01.html"><strong aria-hidden="true">13.2.</strong> 0000E - MessagePack support</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-00010-00-rfc-01.html"><strong aria-hidden="true">13.3.</strong> 00010 - CdlIM Versioning</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-00011-00-rfc-01.html"><strong aria-hidden="true">13.4.</strong> 00011 - Materialization - Overview</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-00012-00-rfc-01.html"><strong aria-hidden="true">13.5.</strong> 00012 - Edge Registry</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-00013-00-rfc-01.html"><strong aria-hidden="true">13.6.</strong> 00013 - Materialized Views</a></li><li class="chapter-item expanded "><a href="../rfc/CDLF-00014-00-rfc-01.html"><strong aria-hidden="true">13.7.</strong> 00014 - Commit message formalization</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Common Data Layer</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/epiphany-platform/CommonDataLayer" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#front-matter" id="front-matter">Front Matter</a></h1>
<pre><code>Title: Alternative communication method to Kafka and RabbitMQ
Author: Wojciech Polak
Team: CDL
Reviewer: CDLTeam
Created on: 11/02/2021
Last updated: 11/02/2021
Tracking issue: https://github.com/epiphany-platform/CommonDataLayer/issues/68
</code></pre>
<h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<h2><a class="header" href="#summary" id="summary">Summary</a></h2>
<p>We should add GRPC communication in all components that are using right now Kafka or <code>RMQ</code>. We should introduce a standard interface and separate whatever we are doing with input messages from the transportation layer.</p>
<h2><a class="header" href="#glossary" id="glossary">Glossary</a></h2>
<p><code>RMQ</code> names any <code>AMQP</code> server - most common is<code>RabbitMq</code> <br />
<code>MQ</code> - Message Queue - Kafka or <code>RMQ</code> <br />
<code>CS</code> - command service</p>
<h2><a class="header" href="#background" id="background">Background</a></h2>
<p>Right now, most of our communication in CDL ingestion is handled by either Kafka or <code>RMQ</code>. While this is acceptable for some clients, there is a case where CDL should not communicate via message queue at all. Therefore we need a replacement protocol, and we could use GRPC for that purpose.</p>
<p>What is more - right now, we have a partially-baked solution in <code>CS</code> - this service accepts either <code>MQ</code> or <code>GRPC</code> as a communication method; however, <code>DR</code> can only produce messages to Kafka or <code>RMQ</code>. Furthermore, this solution has mixed business logic with the transportation layer, which causes some unnecessary repetitions in the codebase. It makes it harder to maintain than it should be.</p>
<h2><a class="header" href="#goals-and-requirements" id="goals-and-requirements">Goals and Requirements</a></h2>
<ul>
<li>Accept <code>GRPC port</code> env variable (or command-line argument).</li>
<li>If GRPC has been chosen over <code>MQ</code> - start endpoint.</li>
<li>Each service should share code between the <code>MQ</code> handler and <code>GRPC</code> handler.</li>
<li>Code handling message should not depend directly on any communication method. It should be under an abstraction.</li>
</ul>
<h1><a class="header" href="#solutions" id="solutions">Solutions</a></h1>
<h2><a class="header" href="#existing-solution" id="existing-solution">Existing solution</a></h2>
<p>We are currently using <code>GRPC</code> only for querying data and communication between CLI/GUI/API and schema registry.</p>
<p><code>GRPC</code> support in the ingestion part of CDL is not finished.</p>
<p>A client cannot use CDL without <code>MQ</code>.</p>
<p>Additionally, right now, CDL uses the same topic for both error notifications and report notifications.</p>
<ul>
<li>Error notifications inform the client about errors, for example, because of a corrupted message - it has the same purpose as good logging and monitoring. In the GRPC world, we can also return information about the error in the response.</li>
<li>Reports inform clients about the resolution on <code>object</code> level - if data sent to <code>MQ</code> has been processed by CDL and stored in DB or rejected.</li>
</ul>
<p>CDL needs notifications in the async world because there is no way to inform the client about corruption/resolution directly; however, this is not necessary in the GRPC world (at least not the error notification part).</p>
<p>What is worth mentioning - this RFC requires finding some middle ground between sync (<code>GRPC</code>) and async (<code>MQ</code>) world. </p>
<p>By saying <code>GRPC</code> in sync, we mean - it requires that each request returns a response, while <code>MQ</code> has more <em>fire and forget</em> behavior. In both scenarios, rust implementation is using tokio and async-await features.</p>
<p>These features, unfortunately, are not common.
<code>MQ</code> is heavily based on the <code>Stream</code> trait while <code>GRPC</code> uses <code>async-trait</code>.</p>
<p>Unfortunately, because Kafka uses borrowed messages it requires box leaking, which might be dangerous when left alone. The message is also wrapped into the <code>Box</code> to allow dynamic dispatch (to acknowledge either Kafka message or <code>RMQ</code> message).</p>
<h2><a class="header" href="#proposed-solution" id="proposed-solution">Proposed solution</a></h2>
<h3><a class="header" href="#async-trait" id="async-trait">Async trait</a></h3>
<p>As previously mentioned, the transportation layer should be invisible to the user. To do so, I'd like to introduce a new async trait:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait ConsumerHandler {
    async fn handle(&amp;self, msg: &amp;dyn Message) -&gt; Result&lt;()&gt;;
}
<span class="boring">}
</span></code></pre></pre>
<p>Each service would implement that handler trait to receive messages from <code>MQ</code>/<code>GRPC</code>.</p>
<p>First of all, while we switch from <code>Stream</code> trait to <code>async trait</code>, we cannot simply remove <code>Box::leak</code>. We could do it when we limit the code to the ordered single-threaded solution, however that would create a hughe performance hit.</p>
<p>Instead, we still need to rely on leaking because <code>tokio::spawn</code> (called inside of the transportation layer) requires <code>'static</code> lifetime. In the future we might be able to either ditch borrowed message and replace it with owned, or use proposed structured concurrency which would enable to spawn task with some non static lifetime (because we could guarantee that all tasks should finish before we drop the consumer).</p>
<p>Second of all message is no longer wrapped in <code>Box</code> - instead, the user receives only <strong>reference</strong> to the dynamic object.</p>
<p>Lastly - handler returns <code>anyhow::Result</code> - so transportation layer based on that can:</p>
<ul>
<li><code>GRPC</code> - return response either OK/Internal Server Error/Bad Request (TBD how to distinguish between last two)</li>
<li><code>MQ</code> - use acknowledge, negative acknowledge (in <code>RMQ</code>) or only doing nothing and not responding at all to the message broker.</li>
</ul>
<h3><a class="header" href="#internal-implementation" id="internal-implementation">Internal implementation</a></h3>
<p>Internal implementation is quite simple. We keep <code>enum Consumer</code>, which accepts in its constructor our instance of <code>ConsumerHandler</code> along with configuration parameters (URL address to Kafka broker etc.).</p>
<p>Inside of method <code>async fn run(self)</code> we match consumer variant and either run simplest possible <code>while let Some()</code> loop for <code>MQ</code>, or initiate <code>GRPC</code> server.</p>
<p>Per each received message (either from <code>MQ</code> or in <code>GRPC</code> server implementation), we can call <code>consumer_handler.handle(&amp;msg)</code> and wait for the response. Simple as that.
To enable better performance we would call this handler inside of <code>tokio::spawn</code>. What is worth mentioning, <code>MQ</code> acknowledges should be sent inside of the spawned task.</p>
<p><code>GRPC</code> is unordered by design, if client needs an ordering, it needs to send one request at the time - it is it's responsibility, not CDL.</p>
<h3><a class="header" href="#grpc-protocol-schema" id="grpc-protocol-schema">GRPC protocol schema</a></h3>
<p>To unify all internal communication in CDL ingestion, we need to use a common, shared GRPC protocol.</p>
<pre><code class="language-proto">syntax = &quot;proto2&quot;;

package generic_rpc;

service GenericRPC {
    rpc Push(Message) returns (Empty);
}

message Message {
  required string key = 1;
  required bytes payload = 2;
}

message Empty {}
</code></pre>
<p>Thanks to that, we can imitate a message just like the one received from <code>MQ</code>.</p>
<h3><a class="header" href="#notifications--error-reporting" id="notifications--error-reporting">Notifications &amp; Error reporting</a></h3>
<p>No client requires error reporting, and we are already sending logs. Therefore it is not needed and can be removed.</p>
<p>Notifications are a bit more complicated. These are <code>CS</code> specific, and therefore, cannot be part of the transportation layer (transparent to the user code).</p>
<p>We need to introduce <code>ReportSender</code> for GRPC.
An abstracted producer which sends reports to given sink. </p>
<p>One cannot send the report to any <code>MQ</code>. One suggested way is to send the callback to some specified endpoint by sending a <code>POST</code> request. Another is to use elastic search or Postgres.</p>
<p>This issue is open for further discussion.</p>
<h2><a class="header" href="#alternative-solutions" id="alternative-solutions">Alternative solutions</a></h2>
<h3><a class="header" href="#rest" id="rest">REST</a></h3>
<p>Instead of using GRPC we could use simple HTTP REST requests.</p>
<h4><a class="header" href="#advantages" id="advantages">Advantages</a></h4>
<ul>
<li>Simpler to implement</li>
<li>Do not need protocol schema</li>
<li>Based on HTTP - usable with service mesh</li>
<li>No mixed protobuf with pure JSON in payload - simpler to deserialize</li>
</ul>
<h4><a class="header" href="#disadvantages" id="disadvantages">Disadvantages</a></h4>
<ul>
<li>Requires extra effort to switch from GRPC</li>
<li>Does not solve client code generation like GRPC</li>
</ul>
<h3><a class="header" href="#custom-tcp" id="custom-tcp">Custom TCP</a></h3>
<p>Instead of relying on existing protocol, we could also create custom one based on TCP.</p>
<h4><a class="header" href="#advantages-1" id="advantages-1">Advantages</a></h4>
<ul>
<li>Full controll on design</li>
<li>Probably fastest method (if done right)</li>
</ul>
<h4><a class="header" href="#disadvantages-1" id="disadvantages-1">Disadvantages</a></h4>
<ul>
<li>Requires a lot of effort with designing, testing and benchmarking,</li>
<li>Needs extra careful touch in areas regarding timeout connections, closed sockets etc.</li>
<li>Requires writing custom client libraries in popular languages: Java, Python, C#, JavaScript</li>
</ul>
<h3><a class="header" href="#zeromq" id="zeromq">ZeroMQ</a></h3>
<p>While we shouldn't replace Kafka nor RabbitMQ with zeroMQ, we can consider it for ReqResp.</p>
<h4><a class="header" href="#advantages-2" id="advantages-2">Advantages</a></h4>
<ul>
<li>Fast, marketed as &quot;zero-abstraction&quot;</li>
<li>Similar interface to other <code>MQ</code> - it could ease creating an abstraction</li>
</ul>
<h4><a class="header" href="#disadvantages-2" id="disadvantages-2">Disadvantages</a></h4>
<ul>
<li>Rust client library lacks good example how to use it in <code>async-await</code> environment,</li>
<li>There are pinpointed problems with ZMQ listed by one of Rust client maintainers: https://github.com/jean-airoldie/libzmq-rs/issues/125#issuecomment-570551319</li>
</ul>
<h2><a class="header" href="#conclusion" id="conclusion">Conclusion</a></h2>
<p>GRPC seems to be easiest way to implement <code>MQ</code>-independence, however later we should re-evaluate REST and probably switch to it.
What is worth noting, after we switch CDL to one, abstracted and unified transportation layer, further change from GRPC to REST should be relatively easier.</p>
<h1><a class="header" href="#test-plan" id="test-plan">Test Plan</a></h1>
<p>There should be at least one end-to-end test checking if the whole pipeline works in an <code>MQ</code>-less environment.
We should run exactly same tests as we have now but with different env variables. All tests designed for <code>MQ</code> environment should pass in <code>GRPC</code> environment.</p>
<h1><a class="header" href="#futher-considerations" id="futher-considerations">Futher considerations</a></h1>
<h2><a class="header" href="#schema-registry-replication" id="schema-registry-replication">Schema Registry replication</a></h2>
<p>Replication featutre for Schema Registry needs major refactor (and probably replacement), therefore it is out of the scope of this change. Replication for <code>GRPC</code> should be deactivated.</p>
<h2><a class="header" href="#impact-on-other-teams" id="impact-on-other-teams">Impact on other teams</a></h2>
<p>Teams that are using <code>MQ</code> won't feel any difference. This refactor would allow other clients to use CDL.</p>
<h2><a class="header" href="#security" id="security">Security</a></h2>
<p>No security risk.</p>
<h1><a class="header" href="#tasks-and-timeline" id="tasks-and-timeline">Tasks and timeline</a></h1>
<p>TBD</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../configuration/schema-registry.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../rfc/CDLF-0000E-00-rfc-01.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../configuration/schema-registry.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../rfc/CDLF-0000E-00-rfc-01.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
